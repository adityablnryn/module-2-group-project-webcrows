<html>
<link rel="stylesheet" type="text/css" href="/client/grid.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>

  <script>
   function creategrid (req){
    var lastClicked;
    var grid = clickableGrid(8,8,function(el,row,col,i){
    console.log("You clicked on element:",el);
    console.log("You clicked on row:",row);
    console.log("You clicked on col:",col);
    console.log("You clicked on item #:",i);

    el.className='clicked';
    if (lastClicked) {
      var co = {contact_name :"Scott",company_name:"HP"};
      var coordinates = { "rows":row,
                        "cols":col,
                        "state":req};

      $.ajax({
       type: "POST",
       data :JSON.stringify(coordinates),
       url: "/move",
       contentType: "application/json",
       success: printsuccess()
     });

      lastClicked.className='';

    }

    lastClicked = el;
});

function printsuccess(){
  console.log("success");
}
document.body.appendChild(grid);

function clickableGrid( rows, cols, callback ){
    var i=0;
    var grid = document.createElement('table');
    grid.style.borderSpacing = "15px";
    grid.style.backgroundImage="url('/client/img/map.jpg')"
    grid.className = 'grid';
    for (var r=0;r<rows;++r){
        var tr = grid.appendChild(document.createElement('tr'));
        for (var c=0;c<cols;++c){
            var cell = tr.appendChild(document.createElement('td'));
            i++;

             if(req[r][c]==0)
            cell.innerHTML = '<img src=\'/client/img/piece_white.png\' height="60" width="60">';
          else   if(req[r][c]==1)
            cell.innerHTML = '<img src=\'/client/img/piece_black.png\' height="60" width="60">';

                 else cell.innerHTML = '<img src=\'/client/img/piece_red.png\' height="60" width="60">';
            cell.addEventListener('click',(function(el,r,c,i){
                return function(){
                    callback(el,r,c,i);
                }
            })(cell,r,c,i),false);
        }
    }
    return grid;
}
   }

    </script>
    <body onload="creategrid([[3,3,3,3,3,3,3,3],[ 3,3,3,0,0,0,1,1], [1,1,3,3,0,0,1,0] ,[3,3,3,3,3,3,3,3], [0,0,1,1,3,3,3,0],[ 3,3,3,1,0,0,1,1],[ 0,0,1,1,3,3,3,3], [1,1,1,3,3,3,0,1] ]) ">

    </body>

</html>
